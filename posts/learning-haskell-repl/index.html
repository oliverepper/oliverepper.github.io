<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="oliep"/><link rel="canonical" href="https://oliver-epper.de/posts/learning-haskell-repl"/><meta name="twitter:url" content="https://oliver-epper.de/posts/learning-haskell-repl"/><meta name="og:url" content="https://oliver-epper.de/posts/learning-haskell-repl"/><title>Learning Haskell – REPL | oliep</title><meta name="twitter:title" content="Learning Haskell – REPL | oliep"/><meta name="og:title" content="Learning Haskell – REPL | oliep"/><meta name="description" content="I build a REPL in Haskell"/><meta name="twitter:description" content="I build a REPL in Haskell"/><meta name="og:description" content="I build a REPL in Haskell"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to oliep"/></head><body><div class="wrapper"><header><div class="container"><nav class="navigation"><a href="/">oliep</a><ul><li><a href="/posts">Posts</a></li><li><a href="/apps">Apps</a></li><li><a href="https://golf.oliver-epper.de">Golf</a></li><li><a href="/about">About</a></li></ul></nav></div></header><main class="grow"><div class="container"><article><h1>Learning Haskell – REPL</h1><div class="item-metadata"><ul><li><span class="fas fa-calendar"></span>18. August 2024</li><li><span class="fas fa-clock"></span>1-minute read</li></ul><div class="taglist"><span class="fas fa-tags"></span><a href="/tags/haskell">Haskell</a>&middot;<a href="/tags/functor">Functor</a></div></div><p>Because I am doing a lot of library work and I prefer text-based interfaces I always enjoy having a REPL (Read Evaluate Print Loop) next to my libraries for easy testing.</p><p>Here's my first Haskell REPL. This is actually quite nice, I think.</p><pre><code><div class="highlight"><span></span><span class="kr">module</span><span class="w"> </span><span class="nn">Cli</span><span class="w"> </span><span class="kr">where</span>

<span class="kr">import</span><span class="w"> </span><span class="nn">System.IO</span>
<span class="w">    </span><span class="p">(</span><span class="w"> </span><span class="nf">hSetBuffering</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="nf">hSetEcho</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="nf">hGetChar</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="nf">hGetLine</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="nf">hFlush</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="nf">stdin</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="nf">stdout</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="kt">BufferMode</span><span class="p">(</span><span class="kt">NoBuffering</span><span class="p">,</span><span class="kt">LineBuffering</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>

<span class="kr">import</span><span class="w"> </span><span class="nn">Control.Exception</span>
<span class="w">    </span><span class="p">(</span><span class="w"> </span><span class="kt">Exception</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="nf">throwIO</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="nf">try</span>
<span class="w">    </span><span class="p">)</span>

<span class="kr">import</span><span class="w"> </span><span class="nn">System.Console.ANSI</span>
<span class="w">    </span><span class="p">(</span><span class="w"> </span><span class="nf">getCursorPosition</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="nf">setCursorPosition</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="nf">clearScreen</span>
<span class="w">    </span><span class="p">)</span>

<span class="kr">data</span><span class="w"> </span><span class="kt">Command</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">One</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">Two</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">Clear</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">Cancel</span><span class="w"> </span><span class="kr">deriving</span><span class="w"> </span><span class="p">(</span><span class="kt">Eq</span><span class="p">,</span><span class="w"> </span><span class="kt">Show</span><span class="p">)</span>

<span class="kr">data</span><span class="w"> </span><span class="kt">UnknownCommandException</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">UnknownCommand</span><span class="w"> </span><span class="kt">Char</span><span class="w"> </span><span class="kr">deriving</span><span class="w"> </span><span class="kt">Show</span>
<span class="kr">instance</span><span class="w"> </span><span class="kt">Exception</span><span class="w"> </span><span class="kt">UnknownCommandException</span>

<span class="nf">moveLeft</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">IO</span><span class="w"> </span><span class="nb">()</span>
<span class="nf">moveLeft</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">    </span><span class="n">position</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">getCursorPosition</span>
<span class="w">    </span><span class="kr">case</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="kr">of</span>
<span class="w">        </span><span class="kt">Just</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span>
<span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span>
<span class="w">                </span><span class="kr">then</span><span class="w"> </span><span class="n">setCursorPosition</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                </span><span class="kr">else</span><span class="w"> </span><span class="n">return</span><span class="nb">()</span>
<span class="w">        </span><span class="kr">_</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">return</span><span class="w"> </span><span class="nb">()</span>

<span class="nf">getCommand</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">IO</span><span class="w"> </span><span class="kt">Command</span>
<span class="nf">getCommand</span><span class="w"> </span><span class="n">prompt</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">    </span><span class="n">hSetBuffering</span><span class="w"> </span><span class="n">stdin</span><span class="w"> </span><span class="kt">NoBuffering</span>
<span class="w">    </span><span class="n">hSetEcho</span><span class="w"> </span><span class="n">stdin</span><span class="w"> </span><span class="kt">False</span>
<span class="w">    </span><span class="n">putStr</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">prompt</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s">&quot;: &quot;</span>
<span class="w">    </span><span class="n">hFlush</span><span class="w"> </span><span class="n">stdout</span>
<span class="w">    </span><span class="n">input</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">hGetChar</span><span class="w"> </span><span class="n">stdin</span>
<span class="w">    </span><span class="kr">case</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="kr">of</span>
<span class="w">        </span><span class="sc">&#39;o&#39;</span><span class="w">                         </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">return</span><span class="w"> </span><span class="kt">One</span>
<span class="w">        </span><span class="sc">&#39;t&#39;</span><span class="w">                         </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">readTwo</span>
<span class="w">        </span><span class="sc">&#39;0&#39;</span><span class="w">                         </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">return</span><span class="w"> </span><span class="kt">Clear</span>
<span class="w">        </span><span class="n">c</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;c&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;q&#39;</span><span class="w">    </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">return</span><span class="w"> </span><span class="kt">Cancel</span>
<span class="w">        </span><span class="kr">_</span><span class="w">                           </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">throwIO</span><span class="w"> </span><span class="p">(</span><span class="kt">UnknownCommand</span><span class="w"> </span><span class="n">input</span><span class="p">)</span>

<span class="nf">readTwo</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">IO</span><span class="w"> </span><span class="kt">Command</span>
<span class="nf">readTwo</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">    </span><span class="n">moveLeft</span>
<span class="w">    </span><span class="n">putStr</span><span class="w"> </span><span class="s">&quot;Enter text to reverse: &quot;</span>
<span class="w">    </span><span class="n">hFlush</span><span class="w"> </span><span class="n">stdout</span>
<span class="w">    </span><span class="n">hSetBuffering</span><span class="w"> </span><span class="n">stdin</span><span class="w"> </span><span class="kt">LineBuffering</span>
<span class="w">    </span><span class="n">hSetEcho</span><span class="w"> </span><span class="n">stdin</span><span class="w"> </span><span class="kt">True</span>
<span class="w">    </span><span class="n">input</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">hGetLine</span><span class="w"> </span><span class="n">stdin</span>
<span class="w">    </span><span class="n">return</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">Two</span><span class="w"> </span><span class="n">input</span>

<span class="nf">handleCommand</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Command</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">IO</span><span class="w"> </span><span class="kt">Bool</span>
<span class="nf">handleCommand</span><span class="w"> </span><span class="kt">Cancel</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">putChar</span><span class="w"> </span><span class="kt">&#39;\</span><span class="n">n&#39;</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">return</span><span class="w"> </span><span class="kt">False</span>
<span class="nf">handleCommand</span><span class="w"> </span><span class="p">(</span><span class="kt">Two</span><span class="w"> </span><span class="n">str</span><span class="p">)</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">    </span><span class="n">putStrLn</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">reverse</span><span class="w"> </span><span class="n">str</span>
<span class="w">    </span><span class="n">return</span><span class="w"> </span><span class="kt">True</span>
<span class="nf">handleCommand</span><span class="w"> </span><span class="kt">Clear</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">    </span><span class="n">clearScreen</span>
<span class="w">    </span><span class="n">setCursorPosition</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">return</span><span class="w"> </span><span class="kt">True</span>
<span class="nf">handleCommand</span><span class="w"> </span><span class="n">cmd</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">    </span><span class="n">putStrLn</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">cmd</span>
<span class="w">    </span><span class="n">return</span><span class="w"> </span><span class="kt">True</span>

<span class="nf">handleUnknownCommandException</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">IO</span><span class="w"> </span><span class="kt">Bool</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">IO</span><span class="w"> </span><span class="kt">Bool</span>
<span class="nf">handleUnknownCommandException</span><span class="w"> </span><span class="n">ioAction</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">    </span><span class="n">result</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">try</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">ioAction</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">IO</span><span class="w"> </span><span class="p">(</span><span class="kt">Either</span><span class="w"> </span><span class="kt">UnknownCommandException</span><span class="w"> </span><span class="kt">Bool</span><span class="p">)</span>
<span class="w">    </span><span class="kr">case</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="kr">of</span>
<span class="w">        </span><span class="kt">Left</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="ow">-&gt;</span>
<span class="w">            </span><span class="n">print</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">UnknownCommandException</span><span class="p">)</span>
<span class="w">            </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">return</span><span class="w"> </span><span class="kt">True</span>
<span class="w">        </span><span class="kt">Right</span><span class="w"> </span><span class="n">continue</span><span class="w"> </span><span class="ow">-&gt;</span>
<span class="w">            </span><span class="n">return</span><span class="w"> </span><span class="n">continue</span>

<span class="nf">loop</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">IO</span><span class="w"> </span><span class="kt">Bool</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">IO</span><span class="w"> </span><span class="nb">()</span>
<span class="nf">loop</span><span class="w"> </span><span class="n">ioAction</span><span class="w"> </span><span class="ow">=</span>
<span class="w">    </span><span class="n">ioAction</span><span class="w"> </span><span class="o">&gt;&gt;=</span><span class="w"> </span><span class="nf">\</span><span class="n">continue</span><span class="w"> </span><span class="ow">-&gt;</span>
<span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="n">continue</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="n">loop&#39;</span><span class="w"> </span><span class="n">ioAction</span>
<span class="w">        </span><span class="kr">else</span><span class="w"> </span><span class="n">return</span><span class="w"> </span><span class="nb">()</span>

<span class="nf">repl</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">IO</span><span class="w"> </span><span class="nb">()</span>
<span class="nf">repl</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">loop</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">handleUnknownCommandException</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">getCommand</span><span class="w"> </span><span class="s">&quot;$&quot;</span><span class="w"> </span><span class="o">&gt;&gt;=</span><span class="w"> </span><span class="n">handleCommand</span>
</div></code></pre><p>This is not necessarily the way you would want to do it. I wanted getCommand to throw an exception and I wanted a clear separation between the elements that form the REPL. I have just started learning Haskell so suggestions are very welcome.</p></article></div></main><footer><div class="container"><div class="credits">Oliver Epper &middot; made with <a href="https://github.com/johnsundell/publish" target="_blank">Publish</a> &middot;  inspired by <a href="https://github.com/luizdepra/hugo-coder" target="_blank">Coder</a> &middot; <a href="/feed.rss">RSS feed</a></div></div></footer></div><script src="https://kit.fontawesome.com/fd7cbf6928.js" crossorigin="anonmous"></script></body></html>