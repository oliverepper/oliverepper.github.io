<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>xcframework on oliep</title>
    <link>https://oliverepper.github.io/tags/xcframework/</link>
    <description>Recent content in xcframework on oliep</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <lastBuildDate>Thu, 20 Feb 2020 09:41:00 +0200</lastBuildDate>
    
	<atom:link href="https://oliverepper.github.io/tags/xcframework/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>How to use CoreData inside xcframework</title>
      <link>https://oliverepper.github.io/posts/how-to-use-coredata-inside-xcframework/</link>
      <pubDate>Thu, 20 Feb 2020 09:41:00 +0200</pubDate>
      
      <guid>https://oliverepper.github.io/posts/how-to-use-coredata-inside-xcframework/</guid>
      <description>&lt;p&gt;The company I work for distributes a binary framework that records data on an iPhone. Since I am in charge of that framework and I enjoy working with CoreData I wanted to use it to store the collected data.
Sadly my first attempt of doing this resulted in an error when I tried to use the framework inside an actual app.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;@NSManaged not allowed on computed properties&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This is coming from the generated .swiftinterface file so there is not much you can do about it.
With a little research and some help I found the good news:&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/apple/swift/pull/27676&#34;&gt;[ModuleInterfaces] Don&amp;rsquo;t diagnose @NSManaged properties with accessors #27676&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;So there is a fix ðŸ¤—&lt;/p&gt;
&lt;h2 id=&#34;get-the-fix&#34;&gt;Get the fix&lt;/h2&gt;
&lt;p&gt;At the time of writing all you need to do is to download and use the Xcode beta (11.4) which comes with a newer version of the Swift compiler that already has the fix.
The rest is then pretty straight forward.&lt;/p&gt;
&lt;h2 id=&#34;create-the-datamodel&#34;&gt;Create the DataModel&lt;/h2&gt;
&lt;p&gt;You can use File-&amp;gt;New and then search for â€žData Modelâ€œ in the template chooser. I will call it `MyDataModel for demo purpose.&lt;/p&gt;
&lt;h2 id=&#34;create-an-instance-of-nspersistentcontainer-in-your-framework-code&#34;&gt;Create an instance of NSPersistentContainer in your framework code&lt;/h2&gt;
&lt;p&gt;This might not be obvious at first, but it is not hard. When you create an app with core data you get the following code inside your AppDelegate:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-Swift&#34; data-lang=&#34;Swift&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;lazy&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; persistentContainer: NSPersistentContainer = {
  &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; container = NSPersistentContainer(name: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;DemoApp&amp;#34;&lt;/span&gt;)
  container.loadPersistentStores(completionHandler: { (storeDescription, error) &lt;span style=&#34;color:#66d9ef&#34;&gt;in&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; error = error &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; NSError? {
      fatalError(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Unresolved error &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;\(&lt;/span&gt;error&lt;span style=&#34;color:#e6db74&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;, &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;\(&lt;/span&gt;error.userInfo&lt;span style=&#34;color:#e6db74&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;)
    }
  })
  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; container
}()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;While the initializer &lt;code&gt;init(name: String)&lt;/code&gt; of &lt;code&gt;NSPersistentContainer&lt;/code&gt; is pretty convenient we canâ€™t use it, because in the context of the running app it simply couldnâ€™t find the model. We need to use &lt;code&gt;init(name: String, managedObjectModel: NSManagedObjectModel)&lt;/code&gt; to get the container. &lt;code&gt;NSManagedObjectModel&lt;/code&gt; has an initializer that takes an &lt;code&gt;URL&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;So update the above to this instead:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-Swift&#34; data-lang=&#34;Swift&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;lazy&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; persistentContainer: NSPersistentContainer = {
    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; modelName = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;MyDataModel&amp;#34;&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;guard&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; modelDir = Bundle(&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;: type(of: &lt;span style=&#34;color:#66d9ef&#34;&gt;self&lt;/span&gt;)).url(forResource: modelName, withExtension: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;momd&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; { fatalError() }
    &lt;span style=&#34;color:#66d9ef&#34;&gt;guard&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; mom = NSManagedObjectModel(contentsOf: modelDir) &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; { fatalError() }

    &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; container = NSPersistentContainer(name: modelName, managedObjectModel: mom)
    container.loadPersistentStores(completionHandler: { (storeDescription, error) &lt;span style=&#34;color:#66d9ef&#34;&gt;in&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; error = error &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; NSError? {
            fatalError(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Unresolved error &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;\(&lt;/span&gt;error&lt;span style=&#34;color:#e6db74&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;, &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;\(&lt;/span&gt;error.userInfo&lt;span style=&#34;color:#e6db74&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;)
        }
    })
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; container
}()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;final&#34;&gt;Final&lt;/h2&gt;
&lt;p&gt;Please be aware, that a CoreData App has a &lt;code&gt;saveContext&lt;/code&gt; function that gets automatically called by the &lt;code&gt;SceneDelegate&lt;/code&gt; when the scene enters the background. If you want to use CoreData in a framework I guess youâ€™ll decide when to save by yourself, anyways.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
